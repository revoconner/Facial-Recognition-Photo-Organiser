<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container" id="appContainer">
        <div class="main-content">
            <div class="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title-row">
                        <div class="sidebar-title">People</div>
                        <div class="sidebar-controls">
                            <button class="icon-btn" id="filterBtn" title="Filter">
                                <div class="doner-icon">
                                    <div class="doner-line"></div>
                                    <div class="doner-line"></div>
                                    <div class="doner-line"></div>
                                </div>
                            </button>
                            <button class="icon-btn" id="jumpToBtn" title="Jump to">
                                <div class="bento-icon">
                                    <div class="bento-dot"></div>
                                    <div class="bento-dot"></div>
                                    <div class="bento-dot"></div>
                                    <div class="bento-dot"></div>
                                    <div class="bento-dot"></div>
                                    <div class="bento-dot"></div>
                                    <div class="bento-dot"></div>
                                    <div class="bento-dot"></div>
                                    <div class="bento-dot"></div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="people-list" id="peopleList"></div>
            </div>

            <div class="content-area">
                <div class="content-header">
                    <div class="content-title" id="contentTitle">Michael Chen's Photos</div>
                    <div class="content-controls">
                        <div class="size-control">
                            <span class="size-label">Size:</span>
                            <input type="range" class="size-slider" id="sizeSlider" min="100" max="300" value="180">
                        </div>
                        <select class="view-dropdown">
                            <option>Show entire photo</option>
                            <option>Zoom to tagged faces</option>
                        </select>
                    </div>
                </div>
                <div class="photo-grid-container">
                    <div class="photo-grid" id="photoGrid"></div>
                </div>
            </div>
        </div>

        <div class="bottom-bar">
            <div class="bottom-content">
                <button class="settings-btn" id="openSettingsBtn">Settings</button>
                <div class="progress-section">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-text">Scanning: 1200/234567</div>
                </div>
            </div>
            <div class="status-bar">
                <div class="status-info">
                    <span class="status-badge">
                        <span class="status-indicator"></span>
                        PyTorch 0.6+cu126
                    </span>
                    <span>GPU Available</span>
                    <span>CUDA: 12.6</span>
                    <span>Found: 12005 faces</span>
                </div>
            </div>
        </div>
    </div>

    <div class="settings-overlay" id="settingsOverlay">
        <div class="settings-container" id="settingsContainer">
            <div class="settings-sidebar">
                <div class="settings-header">
                    <div class="settings-title">Settings</div>
                </div>
                
                <div class="settings-nav">
                    <div class="nav-item active" data-panel="general">General Settings</div>
                    <div class="nav-item" data-panel="folders">Folders to Scan</div>
                    <div class="nav-item" data-panel="log">View Log</div>
                </div>
                
                <div class="settings-footer">
                    <button class="close-settings-btn" id="closeSettingsBtn">Close Settings</button>
                    <div class="footer-credit">Made by RO</div>
                </div>
            </div>
            
            <div class="settings-content">
                <div class="content-panel active" id="general-panel">
                    <div class="panel-title">General Settings</div>
                    
                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Threshold</span>
                                <span class="info-icon">
                                    i
                                    <div class="tooltip">Change threshold values for the AI to detect faces, higher values = stricter match, so similar looking faces will be scrutinized better, but it also may end up creating more persons for different lighting conditions. Default 50%</div>
                                </span>
                            </div>
                            <div class="threshold-control">
                                <div class="threshold-slider-wrapper">
                                    <input type="range" class="threshold-slider" id="thresholdSlider" 
                                           min="10" max="90" value="50">
                                    <span class="threshold-value" id="thresholdValue">50%</span>
                                </div>
                                <button class="recalibrate-btn">Recalibrate</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Use system resources dynamically</span>
                                <span class="info-icon">
                                    i
                                    <div class="tooltip">Smartly uses system resources to not hinder user's task. When turn off, the app will perform faster at the cost of fully utilizing system's resources. Default On.</div>
                                </span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Show single unmatched images</span>
                                <span class="info-icon">
                                    i
                                    <div class="tooltip">Faces that have no matches with any other image are hidden by default, as they are likely images users do not care about. Show them grouped under UNMATCHED FACES. Default Off</div>
                                </span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Use GPU</span>
                                <span class="info-icon">
                                    i
                                    <div class="tooltip">Use GPU for faster processing. Works best with Nvidia GPU. Falls back to CPU automatically if GPU is not detected. Default On</div>
                                </span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-row">
                            <div class="setting-label">
                                <span>Show hidden person</span>
                                <span class="info-icon">
                                    i
                                    <div class="tooltip">People hidden from the list by the user will shown in the list again as long as this is turned on. You can unhide individual names from the list once visible. Default Off</div>
                                </span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="content-panel" id="folders-panel">
                    <div class="panel-title">Folders to Scan</div>
                    
                    <div class="folder-section">
                        <div class="folder-section-title">
                            <span>Include folders for scanning</span>
                            <span class="info-icon">
                                i
                                <div class="tooltip">Include all folders that will be scanned for photos. Default is the user's photos library on Windows.</div>
                            </span>
                        </div>
                        <div class="folder-list-container" id="includeFolders">
                            <div class="folder-item" data-path="C:\Windows">C:\Windows</div>
                            <div class="folder-item" data-path="D:\Photos">D:\Photos</div>
                            <div class="folder-item" data-path="C:\Users\Documents">C:\Users\Documents</div>
                            <div class="folder-item" data-path="E:\Media\Images">E:\Media\Images</div>
                        </div>
                        <div class="folder-controls">
                            <button class="folder-btn" id="addIncludeBtn">
                                <span>+</span>
                                <span>Add Folder</span>
                            </button>
                            <button class="folder-btn remove" id="removeIncludeBtn">
                                <span>-</span>
                                <span>Remove Folder</span>
                            </button>
                        </div>
                        <input type="file" class="hidden-file-input" id="includeFileInput" webkitdirectory directory>
                    </div>
                    
                    <div class="folder-section">
                        <div class="folder-section-title">
                            <span>Exclude subfolders from scanning</span>
                            <span class="info-icon">
                                i
                                <div class="tooltip">Exclude subfolders of "included folders" above, that are not to be scanned. This takes precedence over include folders, so if you add the same folder in both include and exclude, the folder will be excluded.</div>
                            </span>
                        </div>
                        <div class="folder-list-container" id="excludeFolders">
                            <div class="folder-item" data-path="C:\Windows\System32">C:\Windows\System32</div>
                            <div class="folder-item" data-path="D:\Photos\Temp">D:\Photos\Temp</div>
                        </div>
                        <div class="folder-controls">
                            <button class="folder-btn" id="addExcludeBtn">
                                <span>+</span>
                                <span>Add Folder</span>
                            </button>
                            <button class="folder-btn remove" id="removeExcludeBtn">
                                <span>-</span>
                                <span>Remove Folder</span>
                            </button>
                        </div>
                        <input type="file" class="hidden-file-input" id="excludeFileInput" webkitdirectory directory>
                    </div>
                    
                    <div class="folder-section">
                        <div class="folder-section-title">
                            <span>Wildcards</span>
                            <span class="info-icon">
                                i
                                <div class="tooltip">Exclude folder names like *temp* or extension like .gif, .tga from being scanned. Separate by comma.</div>
                            </span>
                        </div>
                        <input type="text" class="wildcard-input" id="wildcardsInput" value="*.jpg, *.png, *.gif" placeholder="Enter wildcards separated by comma">
                    </div>
                </div>
                
                <div class="content-panel" id="log-panel">
                    <div class="log-header">
                        <div class="panel-title">View Log</div>
                        <button class="save-log-btn" id="saveLogBtn">
                            <span>Save Log</span>
                        </button>
                    </div>
                    
                    <div class="log-viewer" id="logViewer">
                        <div class="log-entry">[DD-MM-YYYY HH:MM:SS] Example Log Entry 1</div>
                        <div class="log-entry">[DD-MM-YYYY HH:MM:SS] Example Log Entry 2</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const people = [
            { name: 'Sarah Johnson', count: 34, color: '#667eea' },
            { name: 'Emily Davis', count: 18, color: '#f093fb' },
            { name: 'Michael Chen', count: 32, color: '#4facfe' },
            { name: 'David Wilson', count: 15, color: '#43e97b' },
            { name: 'Rachel Martinez', count: 27, color: '#fa709a' },
            { name: 'Jessica Anderson', count: 21, color: '#30cfd0' },
            { name: 'James Thompson', count: 19, color: '#a8edea' },
            { name: 'Amanda Lee', count: 29, color: '#fed6e3' },
            { name: 'Robert Garcia', count: 16, color: '#c1dfc4' },
            { name: 'Christopher Brown', count: 23, color: '#d299c2' },
            { name: 'Jennifer White', count: 31, color: '#fda085' },
            { name: 'Daniel Martinez', count: 14, color: '#f6d365' },
            { name: 'Matthew Harris', count: 26, color: '#96e6a1' }
        ];

        const photoColors = [
            '#4a5568', '#ed8936', '#48bb78', '#4299e1', '#9f7aea',
            '#f56565', '#38b2ac', '#ecc94b', '#ed64a6', '#667eea'
        ];

        let currentPerson = 'Michael Chen';
        let isAlphabetMode = false;
        let activeMenu = null;
        let selectedIncludeItem = null;
        let selectedExcludeItem = null;

        function positionMenu(menu, button) {
            const buttonRect = button.getBoundingClientRect();
            const menuRect = menu.getBoundingClientRect();
            const viewportHeight = window.innerHeight;
            const viewportWidth = window.innerWidth;

            let top = buttonRect.bottom + 4;
            let left = buttonRect.right - menuRect.width;

            if (top + menuRect.height > viewportHeight) {
                top = buttonRect.top - menuRect.height - 4;
            }

            if (left < 0) {
                left = buttonRect.left;
            }

            if (left + menuRect.width > viewportWidth) {
                left = viewportWidth - menuRect.width - 8;
            }

            menu.style.top = top + 'px';
            menu.style.left = left + 'px';
        }

        function renderPeopleList() {
            const peopleList = document.getElementById('peopleList');
            peopleList.innerHTML = '';
            
            people.forEach(person => {
                const item = document.createElement('div');
                item.className = 'person-item';
                if (person.name === currentPerson) item.classList.add('active');
                
                item.innerHTML = `
                    <div class="person-avatar" style="background: linear-gradient(135deg, ${person.color} 0%, ${person.color}99 100%)">
                        ${person.name.charAt(0)}
                    </div>
                    <div class="person-info">
                        <div class="person-name">${person.name}</div>
                        <div class="person-count">${person.count} photos</div>
                    </div>
                    <button class="kebab-menu" data-person="${person.name}">
                        <span class="kebab-dot"></span>
                        <span class="kebab-dot"></span>
                        <span class="kebab-dot"></span>
                    </button>
                `;
                
                const contextMenu = document.createElement('div');
                contextMenu.className = 'context-menu';
                contextMenu.innerHTML = `
                    <div class="context-menu-item" onclick="renamePerson('${person.name}')">Rename</div>
                    <div class="context-menu-item" onclick="hidePerson('${person.name}')">Hide person</div>
                `;
                document.body.appendChild(contextMenu);
                
                item.addEventListener('click', (e) => {
                    if (!e.target.closest('.kebab-menu') && !e.target.closest('.context-menu')) {
                        selectPerson(person.name);
                    }
                });
                
                peopleList.appendChild(item);

                const kebabBtn = item.querySelector('.kebab-menu');
                
                kebabBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const personItem = kebabBtn.closest('.person-item');
                    
                    closeAllMenus();
                    
                    contextMenu.classList.add('show');
                    personItem.classList.add('menu-active');
                    activeMenu = { element: contextMenu, parent: personItem };
                    
                    positionMenu(contextMenu, kebabBtn);
                });

                contextMenu.addEventListener('mouseleave', () => {
                    closeAllMenus();
                });
            });
        }

        function renderAlphabetList() {
            const peopleList = document.getElementById('peopleList');
            peopleList.innerHTML = '';
            
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const availableLetters = new Set(people.map(p => p.name.charAt(0).toUpperCase()));
            
            alphabet.split('').forEach(letter => {
                const item = document.createElement('div');
                item.className = 'alphabet-item';
                if (!availableLetters.has(letter)) {
                    item.classList.add('disabled');
                }
                item.textContent = letter;
                
                if (availableLetters.has(letter)) {
                    item.addEventListener('click', () => {
                        const person = people.find(p => p.name.charAt(0).toUpperCase() === letter);
                        if (person) {
                            isAlphabetMode = false;
                            document.getElementById('jumpToBtn').classList.remove('active');
                            selectPerson(person.name);
                            renderPeopleList();
                        }
                    });
                }
                
                peopleList.appendChild(item);
            });
        }

        function selectPerson(personName) {
            currentPerson = personName;
            const person = people.find(p => p.name === personName);
            
            document.getElementById('contentTitle').textContent = `${personName}'s Photos`;
            
            document.querySelectorAll('.person-item').forEach(item => {
                item.classList.remove('active');
                const nameElement = item.querySelector('.person-name');
                if (nameElement && nameElement.textContent === personName) {
                    item.classList.add('active');
                }
            });
            
            renderPhotos(person.count);
        }

        function renderPhotos(count) {
            const photoGrid = document.getElementById('photoGrid');
            photoGrid.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const photo = document.createElement('div');
                photo.className = 'photo-item';
                photo.innerHTML = `
                    <div class="photo-placeholder" style="background: ${photoColors[i % photoColors.length]}"></div>
                    <button class="kebab-menu">
                        <span class="kebab-dot"></span>
                        <span class="kebab-dot"></span>
                        <span class="kebab-dot"></span>
                    </button>
                `;
                
                const contextMenu = document.createElement('div');
                contextMenu.className = 'context-menu';
                contextMenu.innerHTML = `
                    <div class="context-menu-item" onclick="makePrimaryPhoto()">Make primary photo</div>
                    <div class="context-menu-item" onclick="removeTag()">Remove tag</div>
                    <div class="context-menu-item" onclick="transferTag()">Transfer tag to someone else</div>
                `;
                document.body.appendChild(contextMenu);
                
                photoGrid.appendChild(photo);

                const kebabBtn = photo.querySelector('.kebab-menu');
                
                kebabBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const photoItem = kebabBtn.closest('.photo-item');
                    
                    closeAllMenus();
                    
                    contextMenu.classList.add('show');
                    photoItem.classList.add('menu-active');
                    activeMenu = { element: contextMenu, parent: photoItem };
                    
                    positionMenu(contextMenu, kebabBtn);
                });

                contextMenu.addEventListener('mouseleave', () => {
                    closeAllMenus();
                });
            }
        }

        document.getElementById('jumpToBtn').addEventListener('click', () => {
            isAlphabetMode = !isAlphabetMode;
            document.getElementById('jumpToBtn').classList.toggle('active');
            
            if (isAlphabetMode) {
                renderAlphabetList();
            } else {
                renderPeopleList();
            }
        });

        const sizeSlider = document.getElementById('sizeSlider');
        sizeSlider.addEventListener('input', (e) => {
            const size = e.target.value;
            document.getElementById('photoGrid').style.gridTemplateColumns = `repeat(auto-fill, minmax(${size}px, 1fr))`;
        });

        function renamePerson(name) {
            console.log('Rename person:', name);
            closeAllMenus();
        }

        function hidePerson(name) {
            console.log('Hide person:', name);
            closeAllMenus();
        }

        function makePrimaryPhoto() {
            console.log('Make primary photo');
            closeAllMenus();
        }

        function removeTag() {
            console.log('Remove tag');
            closeAllMenus();
        }

        function transferTag() {
            console.log('Transfer tag');
            closeAllMenus();
        }

        function closeAllMenus() {
            document.querySelectorAll('.context-menu').forEach(m => {
                m.classList.remove('show');
            });
            document.querySelectorAll('.person-item, .photo-item').forEach(item => {
                item.classList.remove('menu-active');
            });
            activeMenu = null;
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.kebab-menu') && !e.target.closest('.context-menu')) {
                closeAllMenus();
            }
        });

        const appContainer = document.getElementById('appContainer');
        const settingsOverlay = document.getElementById('settingsOverlay');
        const settingsContainer = document.getElementById('settingsContainer');
        const openSettingsBtn = document.getElementById('openSettingsBtn');
        const closeSettingsBtn = document.getElementById('closeSettingsBtn');

        function openSettings() {
            settingsOverlay.classList.add('active');
            appContainer.classList.add('blurred');
        }

        function closeSettings() {
            settingsOverlay.classList.remove('active');
            appContainer.classList.remove('blurred');
        }

        openSettingsBtn.addEventListener('click', openSettings);
        closeSettingsBtn.addEventListener('click', closeSettings);

        settingsOverlay.addEventListener('click', (e) => {
            if (e.target === settingsOverlay) {
                closeSettings();
            }
        });

        settingsContainer.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && settingsOverlay.classList.contains('active')) {
                closeSettings();
            }
        });

        const navItems = document.querySelectorAll('.nav-item');
        const panels = document.querySelectorAll('.content-panel');
        const thresholdSlider = document.getElementById('thresholdSlider');
        const thresholdValue = document.getElementById('thresholdValue');

        navItems.forEach(item => {
            item.addEventListener('click', () => {
                navItems.forEach(nav => nav.classList.remove('active'));
                item.classList.add('active');
                
                const panelId = item.getAttribute('data-panel') + '-panel';
                panels.forEach(panel => panel.classList.remove('active'));
                document.getElementById(panelId).classList.add('active');
            });
        });

        thresholdSlider.addEventListener('input', (e) => {
            thresholdValue.textContent = e.target.value + '%';
        });

        const includeFoldersContainer = document.getElementById('includeFolders');
        const excludeFoldersContainer = document.getElementById('excludeFolders');

        includeFoldersContainer.addEventListener('click', (e) => {
            const folderItem = e.target.closest('.folder-item');
            if (folderItem) {
                document.querySelectorAll('#includeFolders .folder-item').forEach(item => {
                    item.classList.remove('selected');
                });
                folderItem.classList.add('selected');
                selectedIncludeItem = folderItem;
            }
        });

        excludeFoldersContainer.addEventListener('click', (e) => {
            const folderItem = e.target.closest('.folder-item');
            if (folderItem) {
                document.querySelectorAll('#excludeFolders .folder-item').forEach(item => {
                    item.classList.remove('selected');
                });
                folderItem.classList.add('selected');
                selectedExcludeItem = folderItem;
            }
        });

        document.getElementById('addIncludeBtn').addEventListener('click', () => {
            document.getElementById('includeFileInput').click();
        });

        document.getElementById('includeFileInput').addEventListener('change', (e) => {
            const files = e.target.files;
            if (files.length > 0) {
                const folderPath = files[0].webkitRelativePath.split('/')[0];
                const fullPath = 'C:\\' + folderPath;
                
                const existingPaths = Array.from(includeFoldersContainer.querySelectorAll('.folder-item'))
                    .map(item => item.getAttribute('data-path'));
                
                if (!existingPaths.includes(fullPath)) {
                    const newItem = document.createElement('div');
                    newItem.className = 'folder-item';
                    newItem.setAttribute('data-path', fullPath);
                    newItem.textContent = fullPath;
                    includeFoldersContainer.appendChild(newItem);
                }
            }
            e.target.value = '';
        });

        document.getElementById('removeIncludeBtn').addEventListener('click', () => {
            if (selectedIncludeItem) {
                selectedIncludeItem.remove();
                selectedIncludeItem = null;
            }
        });

        document.getElementById('addExcludeBtn').addEventListener('click', () => {
            document.getElementById('excludeFileInput').click();
        });

        document.getElementById('excludeFileInput').addEventListener('change', (e) => {
            const files = e.target.files;
            if (files.length > 0) {
                const folderPath = files[0].webkitRelativePath.split('/')[0];
                const fullPath = 'C:\\' + folderPath;
                
                const existingPaths = Array.from(excludeFoldersContainer.querySelectorAll('.folder-item'))
                    .map(item => item.getAttribute('data-path'));
                
                if (!existingPaths.includes(fullPath)) {
                    const newItem = document.createElement('div');
                    newItem.className = 'folder-item';
                    newItem.setAttribute('data-path', fullPath);
                    newItem.textContent = fullPath;
                    excludeFoldersContainer.appendChild(newItem);
                }
            }
            e.target.value = '';
        });

        document.getElementById('removeExcludeBtn').addEventListener('click', () => {
            if (selectedExcludeItem) {
                selectedExcludeItem.remove();
                selectedExcludeItem = null;
            }
        });

        document.getElementById('saveLogBtn').addEventListener('click', () => {
            const logViewer = document.getElementById('logViewer');
            const logContent = logViewer.innerText;
            
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'face-recognition-log.txt';
            document.body.appendChild(a);
            a.click();
            
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        document.querySelectorAll('.info-icon').forEach(icon => {
            icon.addEventListener('mouseenter', function() {
                const tooltip = this.querySelector('.tooltip');
                if (!tooltip) return;
                
                const iconRect = this.getBoundingClientRect();
                const tooltipWidth = 320;
                
                let left = iconRect.left + (iconRect.width / 2) - (tooltipWidth / 2);
                let top = iconRect.top - 12;
                
                if (left < 10) {
                    left = 10;
                }
                if (left + tooltipWidth > window.innerWidth - 10) {
                    left = window.innerWidth - tooltipWidth - 10;
                }
                
                tooltip.style.left = left + 'px';
                tooltip.style.top = top + 'px';
                tooltip.style.transform = 'translateY(-100%)';
            });
        });

        renderPeopleList();
        renderPhotos(32);
    </script>
</body>
</html>